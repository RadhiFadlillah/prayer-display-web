(()=>{function j(e,l){let i=e;if(typeof e=="string"){let n=e.replace(/^\d+/,"");i=parseInt(e,10);switch(n){case"s":i*=1e3;break;case"M":i*=60*1e3;break;case"H":i*=60*60*1e3;break;default:i=0}}return i===0?l:new Promise((n,o)=>{setTimeout(()=>o(new Error(`Timeout after ${e}`)),i),l.then(n,o)})}async function $(e,l,i){let n=fetch(e,i),o=await j(l,n);if(!o.ok){let p=await o.text();throw Error(`${p.trim()} (${o.status})`)}return o.headers.get("content-type")==="application/json"?await o.json():await o.text()}function v(e){return e instanceof Date&&!isNaN(e)}function S(e,l){if(!v(e))return"";let i=e.getHours(),n=e.getMinutes(),o=e.getSeconds(),p=String(i).padStart(2,"0"),d=String(n).padStart(2,"0"),w=String(o).padStart(2,"0");return typeof l=="boolean"&&l?`${p}:${d}:${w}`:(n=o>=30?n+1:n,d=String(n).padStart(2,"0"),`${p}:${d}`)}function T(e){if(!v(e))return"";let l=String(e.getDate()).padStart(2,"0"),i=String(e.getMonth()+1).padStart(2,"0"),n=e.getFullYear();return`${n}-${i}-${l}`}function D(e){switch(e){case 0:return"Minggu";case 1:return"Senin";case 2:return"Selasa";case 3:return"Rabu";case 4:return"Kamis";case 5:return"Jum'at";case 6:return"Sabtu"}}function y(e){return v(e)?new Intl.DateTimeFormat("id-u-ca-islamic",{day:"2-digit",month:"2-digit",year:"2-digit"}).format(e).replace(/\s+H$/i,""):""}function k(){let e={time:new Date(),images:[],events:[],targets:[],nextEvent:-1,activeImage:-1,currentTarget:-1,beep:null,debugMode:!1};function l(){$("/api/data","1m").then(a=>{e.images=a.images;let s=[],t=[];a.events.forEach(g=>{let f=typeof g.iqama=="number"&&g.iqama>0,x=new Date(g.time),b=f?new Date(g.iqama):null;g.name!=="nextFajr"&&s.push({name:g.name,time:x,iqama:b}),t.push({name:g.name,time:x}),f&&t.push({name:`${g.name}Iqama`,time:b})}),e.events=s,e.targets=t;let u=new Date(),r=u.getHours()*60+u.getMinutes(),c=24*60-r+1,h=c*60*1e3;console.log(`Will reload data in ${c} minutes`),setTimeout(l,h)}).catch(a=>{alert(a.message)}).finally(()=>{m.redraw()})}function i(){e.activeImage++,e.activeImage>=e.images.length&&(e.activeImage=0),m.redraw(),setTimeout(i,20*1e3)}function n(){e.debugMode?e.time.setSeconds(e.time.getSeconds()+1):e.time=new Date(),e.nextEvent=e.events.findIndex(s=>{let t=s.iqama||s.time;return s.time>e.time||t>e.time});let a=e.currentTarget;e.currentTarget=e.targets.findIndex(s=>s.time>e.time),a!==-1&&e.currentTarget!==a&&e.beep.play(),m.redraw(),setTimeout(n,1e3)}function o(){if(e.currentTarget<0||e.currentTarget>=e.targets.length)return"";let a=e.targets[e.currentTarget],s=a.time-e.time,t=s/1e3,u=0,r=0,c="";return t>=60*60?(r=Math.floor(t/3600),u=Math.floor((t-r*3600)/60),t=Math.floor(t-r*3600-u*60)):t>=60&&(u=Math.floor(t/60),t=Math.floor(t-u*60)),r>0?u===0?c=`${r} jam lagi`:c=`${r} jam ${u} menit lagi`:u>0?t===0?c=`${u} menit lagi`:c=`${u} menit ${t} detik lagi`:c=`${t} detik lagi`,`${d(a.name)} ${c}`}function p(a){switch(a){case"fajr":return"Subuh";case"sunrise":return"Syuruq";case"zuhr":return"Zuhur";case"asr":return"Ashar";case"maghrib":return"Maghrib";case"isha":return"Isha";case"nextFajr":return"Subuh"}}function d(a){let s="";return a.endsWith("Iqama")&&(s="Iqamah ",a=a.replace(/Iqama$/,"")),s+p(a)}function w(){let a=D(e.time.getDay()),s=S(e.time,!0),t=T(e.time).replace(/\//g,"-"),u=y(e.time).replace(/\//g,"-"),r=e.images[e.activeImage],c={},h=[];r!=null&&(h=[m("img#main-image",{src:r.url,loading:"lazy"})],c={style:{"--main-color":r.mainColor,"--header-main":r.headerMain,"--header-accent":r.headerAccent,"--header-color":r.headerFont,"--footer-main":r.footerMain,"--footer-accent":r.footerAccent,"--footer-color":r.footerFont},onclick(){return e.debugMode=!1,e.time=new Date(),!1}});let g=e.events.map((f,x)=>{let b=[m("p.event__name",p(f.name)),m("p.event__time",S(f.time))];v(f.iqama)&&b.push(m("p.event__iqama",S(f.iqama)));let M={class:x===e.nextEvent?"event--target":null,onclick(){let q=new Date(f.time.getTime()-30*1e3);return e.debugMode=!0,e.time=q,!1}};return m(".event",M,b)});return h.push(m("#header",m("p#clock",s),m("p#date",`${a}, ${t} M / ${u} H`),m("p#countdown",o())),m("#footer",m(".footer__space"),...g,m(".footer__space"))),m("#app",c,h)}function I(){l(),n(),i(),e.beep=new Audio("/res/beep.wav")}return{view:w,oninit:I}}function _(){m.mount(document.body,k)}_();})();
