(()=>{function M(e,c){let n=e;if(typeof e=="string"){let s=e.replace(/^\d+/,"");n=parseInt(e,10);switch(s){case"s":n*=1e3;break;case"M":n*=60*1e3;break;case"H":n*=60*60*1e3;break;default:n=0}}return n===0?c:new Promise((s,o)=>{setTimeout(()=>o(new Error(`Timeout after ${e}`)),n),c.then(s,o)})}async function x(e,c,n){let s=fetch(e,n),o=await M(c,s);if(!o.ok){let g=await o.text();throw Error(`${g.trim()} (${o.status})`)}return o.headers.get("content-type")==="application/json"?await o.json():await o.text()}function v(e){return e instanceof Date&&!isNaN(e)}function S(e,c){if(!v(e))return"";let n=e.getHours(),s=e.getMinutes(),o=e.getSeconds(),g=String(n).padStart(2,"0"),h=String(s).padStart(2,"0"),T=String(o).padStart(2,"0");return typeof c=="boolean"&&c?`${g}:${h}:${T}`:(s=o>=30?s+1:s,h=String(s).padStart(2,"0"),`${g}:${h}`)}function y(e){if(!v(e))return"";let c=String(e.getDate()).padStart(2,"0"),n=String(e.getMonth()+1).padStart(2,"0"),s=e.getFullYear();return`${s}-${n}-${c}`}function D(e){switch(e){case 0:return"Minggu";case 1:return"Senin";case 2:return"Selasa";case 3:return"Rabu";case 4:return"Kamis";case 5:return"Jum'at";case 6:return"Sabtu"}}function I(e){return v(e)?new Intl.DateTimeFormat("id-u-ca-islamic",{day:"2-digit",month:"2-digit",year:"2-digit"}).format(e).replace(/\s+H$/i,""):""}function j(){let e={time:new Date(),images:[],events:[],targets:[],nextEvent:-1,activeImage:-1,currentTarget:-1,beep:null};function c(){x("/api/data","1m").then(t=>{e.images=t.images;let l=[],a=[];t.events.forEach(f=>{let p=typeof f.iqama=="number"&&f.iqama>0,$=new Date(f.time),w=p?new Date(f.iqama):null;f.name!=="nextFajr"&&l.push({name:f.name,time:$,iqama:w}),a.push({name:f.name,time:$}),p&&a.push({name:`${f.name}Iqama`,time:w})}),e.events=l,e.targets=a;let r=new Date(),i=r.getHours()*60+r.getMinutes(),u=24*60-i+1,d=u*60*1e3;console.log(`Will reload data in ${u} minutes`),setTimeout(c,d)}).catch(t=>{alert(t.message)}).finally(()=>{m.redraw()})}function n(){e.activeImage++,e.activeImage>=e.images.length&&(e.activeImage=0),m.redraw(),setTimeout(n,20*1e3)}function s(){let t=new Date(),l=e.events.findIndex(r=>{let i=r.iqama||r.time;return r.time>t||i>t}),a=e.targets.findIndex(r=>r.time>t);e.currentTarget!==-1&&a!==e.currentTarget&&e.beep.play(),e.time=t,e.nextEvent=l,e.currentTarget=a,m.redraw(),setTimeout(s,1e3)}function o(){if(e.currentTarget<0||e.currentTarget>=e.targets.length)return"";let t=e.targets[e.currentTarget],l=t.time-e.time,a=l/1e3,r=0,i=0,u="";return a>=60*60?(i=Math.floor(a/3600),r=Math.floor((a-i*3600)/60),a=Math.floor(a-i*3600-r*60)):a>=60&&(r=Math.floor(a/60),a=Math.floor(a-r*60)),i>0?r===0?u=`${i} jam lagi`:u=`${i} jam ${r} menit lagi`:r>0?a===0?u=`${r} menit lagi`:u=`${r} menit ${a} detik lagi`:u=`${a} detik lagi`,`${h(t.name)} ${u}`}function g(t){switch(t){case"fajr":return"Subuh";case"sunrise":return"Syuruq";case"zuhr":return"Zuhur";case"asr":return"Ashar";case"maghrib":return"Maghrib";case"isha":return"Isha";case"nextFajr":return"Subuh"}}function h(t){let l="";return t.endsWith("Iqama")&&(l="Iqamah ",t=t.replace(/Iqama$/,"")),l+g(t)}function T(){let t=D(e.time.getDay()),l=S(e.time,!0),a=y(e.time).replace(/\//g,"-"),r=I(e.time).replace(/\//g,"-"),i=e.images[e.activeImage],u={},d=[];i!=null&&(d=[m("img#main-image",{src:i.url,loading:"lazy"})],u={style:{"--main-color":i.mainColor,"--header-main":i.headerMain,"--header-accent":i.headerAccent,"--header-color":i.headerFont,"--footer-main":i.footerMain,"--footer-accent":i.footerAccent,"--footer-color":i.footerFont}});let f=e.events.map((p,$)=>{let w=$===e.nextEvent?"event--target":null,b=[m("p.event__name",g(p.name)),m("p.event__time",S(p.time))];return v(p.iqama)&&b.push(m("p.event__iqama",S(p.iqama))),m(".event",{class:w},b)});return d.push(m("#header",m("p#clock",l),m("p#date",`${t}, ${a} M / ${r} H`),m("p#countdown",o())),m("#footer",m(".footer__space"),...f,m(".footer__space"))),u.onclick=()=>{e.beep.play()},m("#app",u,d)}function q(){c(),s(),n(),e.beep=new Audio("/res/beep.wav")}return{view:T,oninit:q}}function k(){m.mount(document.body,j)}k();})();
