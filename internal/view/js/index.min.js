(()=>{function j(e,c){let n=e;if(typeof e=="string"){let o=e.replace(/^\d+/,"");n=parseInt(e,10);switch(o){case"s":n*=1e3;break;case"M":n*=60*1e3;break;case"H":n*=60*60*1e3;break;default:n=0}}return n===0?c:new Promise((o,s)=>{setTimeout(()=>s(new Error(`Timeout after ${e}`)),n),c.then(o,s)})}async function $(e,c,n){let o=fetch(e,n),s=await j(c,o);if(!s.ok){let p=await s.text();throw Error(`${p.trim()} (${s.status})`)}return s.headers.get("content-type")==="application/json"?await s.json():await s.text()}function v(e){return e instanceof Date&&!isNaN(e)}function w(e,c){if(!v(e))return"";let n=e.getHours(),o=e.getMinutes(),s=e.getSeconds(),p=String(n).padStart(2,"0"),d=String(o).padStart(2,"0"),S=String(s).padStart(2,"0");return typeof c=="boolean"&&c?`${p}:${d}:${S}`:(o=s>=30?o+1:o,d=String(o).padStart(2,"0"),`${p}:${d}`)}function T(e){switch(e){case 0:return"Minggu";case 1:return"Senin";case 2:return"Selasa";case 3:return"Rabu";case 4:return"Kamis";case 5:return"Jum'at";case 6:return"Sabtu"}}function D(e){return v(e)?new Intl.DateTimeFormat("id",{day:"2-digit",month:"long",year:"numeric"}).format(e).replace(/\s+M$/i,""):""}function y(e){return v(e)?new Intl.DateTimeFormat("id-u-ca-islamic",{day:"2-digit",month:"long",year:"numeric"}).format(e).replace(/\s+H$/i,""):""}function k(){let e={time:new Date(),images:[],events:[],targets:[],nextEvent:-1,activeImage:-1,currentTarget:-1,beep:null,debugMode:!1};function c(){$("/api/data","1m").then(a=>{e.images=a.images;let i=[],t=[];a.events.forEach(f=>{let g=typeof f.iqama=="number"&&f.iqama>0,x=new Date(f.time),b=g?new Date(f.iqama):null;f.name!=="nextFajr"&&i.push({name:f.name,time:x,iqama:b}),t.push({name:f.name,time:x}),g&&t.push({name:`${f.name}Iqama`,time:b})}),e.events=i,e.targets=t;let u=new Date(),r=u.getHours()*60+u.getMinutes(),l=24*60-r+1,h=l*60*1e3;console.log(`Will reload data in ${l} minutes`),setTimeout(c,h)}).catch(a=>{alert(a.message)}).finally(()=>{m.redraw()})}function n(){e.activeImage++,e.activeImage>=e.images.length&&(e.activeImage=0),m.redraw(),setTimeout(n,20*1e3)}function o(){e.debugMode?e.time.setSeconds(e.time.getSeconds()+1):e.time=new Date(),e.nextEvent=e.events.findIndex(i=>{let t=i.iqama||i.time;return i.time>e.time||t>e.time});let a=e.currentTarget;e.currentTarget=e.targets.findIndex(i=>i.time>e.time),a!==-1&&e.currentTarget!==a&&e.beep.play(),m.redraw(),setTimeout(o,1e3)}function s(){if(e.currentTarget<0||e.currentTarget>=e.targets.length)return"";let a=e.targets[e.currentTarget],i=a.time-e.time,t=i/1e3,u=0,r=0,l="";return t>=60*60?(r=Math.floor(t/3600),u=Math.floor((t-r*3600)/60),t=Math.floor(t-r*3600-u*60)):t>=60&&(u=Math.floor(t/60),t=Math.floor(t-u*60)),r>0?u===0?l=`${r} jam lagi`:l=`${r} jam ${u} menit lagi`:u>0?t===0?l=`${u} menit lagi`:l=`${u} menit ${t} detik lagi`:l=`${t} detik lagi`,`${d(a.name)} ${l}`}function p(a){switch(a){case"fajr":return"Subuh";case"sunrise":return"Syuruq";case"zuhr":return"Zuhur";case"asr":return"Ashar";case"maghrib":return"Maghrib";case"isha":return"Isha";case"nextFajr":return"Subuh"}}function d(a){let i="";return a.endsWith("Iqama")&&(i="Iqamah ",a=a.replace(/Iqama$/,"")),i+p(a)}function S(){let a=T(e.time.getDay()),i=w(e.time,!0),t=D(e.time),u=y(e.time),r=e.images[e.activeImage],l={},h=[];r!=null&&(h=[m("img#main-image",{src:r.url,loading:"lazy"})],l={style:{"--main-color":r.mainColor,"--header-main":r.headerMain,"--header-accent":r.headerAccent,"--header-color":r.headerFont,"--footer-main":r.footerMain,"--footer-accent":r.footerAccent,"--footer-color":r.footerFont},onclick(){return e.debugMode=!1,e.time=new Date(),!1}});let f=e.events.map((g,x)=>{let b=[m("p.event__name",p(g.name)),m("p.event__time",w(g.time))];v(g.iqama)&&b.push(m("p.event__iqama",w(g.iqama)));let M={class:x===e.nextEvent?"event--target":null,onclick(){let q=new Date(g.time.getTime()-15*1e3);return e.debugMode=!0,e.time=q,!1}};return m(".event",M,b)});return h.push(m("#header",m("p#clock",i),m("p#date",`${a}, ${t} M / ${u} H`),m("p#countdown",s())),m("#footer",m(".footer__space"),...f,m(".footer__space"))),m("#app",l,h)}function I(){c(),o(),n(),e.beep=new Audio("/res/beep.wav")}return{view:S,oninit:I}}function _(){m.mount(document.body,k)}_();})();
