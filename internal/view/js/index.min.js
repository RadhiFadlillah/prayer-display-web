(()=>{function M(e,u){let n=e;if(typeof e=="string"){let s=e.replace(/^\d+/,"");n=parseInt(e,10);switch(s){case"s":n*=1e3;break;case"M":n*=60*1e3;break;case"H":n*=60*60*1e3;break;default:n=0}}return n===0?u:new Promise((s,o)=>{setTimeout(()=>o(new Error(`Timeout after ${e}`)),n),u.then(s,o)})}async function D(e,u,n){let s=fetch(e,n),o=await M(u,s);if(!o.ok){let g=await o.text();throw Error(`${g.trim()} (${o.status})`)}return o.headers.get("content-type")==="application/json"?await o.json():await o.text()}function v(e){return e instanceof Date&&!isNaN(e)}function T(e,u){if(!v(e))return"";let n=e.getHours(),s=e.getMinutes(),o=e.getSeconds(),g=String(n).padStart(2,"0"),h=String(s).padStart(2,"0"),w=String(o).padStart(2,"0");return typeof u=="boolean"&&u?`${g}:${h}:${w}`:(s=o>=30?s+1:s,h=String(s).padStart(2,"0"),`${g}:${h}`)}function y(e){if(!v(e))return"";let u=String(e.getDate()).padStart(2,"0"),n=String(e.getMonth()+1).padStart(2,"0"),s=e.getFullYear();return`${s}-${n}-${u}`}function I(e){switch(e){case 0:return"Minggu";case 1:return"Senin";case 2:return"Selasa";case 3:return"Rabu";case 4:return"Kamis";case 5:return"Jum'at";case 6:return"Sabtu"}}function q(e){return v(e)?new Intl.DateTimeFormat("id-u-ca-islamic",{day:"2-digit",month:"2-digit",year:"2-digit"}).format(e).replace(/\s+H$/i,""):""}function E(){let e={time:new Date(),images:[],events:[],targets:[],nextEvent:-1,activeImage:-1,currentTarget:-1};function u(){D("/api/data","1m").then(t=>{e.images=t.images;let l=[],a=[];t.events.forEach(f=>{let p=typeof f.iqama=="number"&&f.iqama>0,$=new Date(f.time),S=p?new Date(f.iqama):null;f.name!=="nextFajr"&&l.push({name:f.name,time:$,iqama:S}),a.push({name:f.name,time:$}),p&&a.push({name:`${f.name}Iqama`,time:S})}),e.events=l,e.targets=a;let r=new Date(),i=r.getHours()*60+r.getMinutes(),c=24*60-i+1,d=c*60*1e3;console.log(`Will reload data in ${c} minutes`),setTimeout(u,d)}).catch(t=>{alert(t.message)}).finally(()=>{m.redraw()})}function n(){e.activeImage++,e.activeImage>=e.images.length&&(e.activeImage=0),m.redraw(),setTimeout(n,20*1e3)}function s(){let t=new Date(),l=e.events.findIndex(r=>{let i=r.iqama||r.time;return r.time>t||i>t}),a=e.targets.findIndex(r=>r.time>t);a!==e.currentTarget,e.time=t,e.nextEvent=l,e.currentTarget=a,m.redraw(),setTimeout(s,1e3)}function o(){if(e.currentTarget<0||e.currentTarget>=e.targets.length)return"";let t=e.targets[e.currentTarget],l=t.time-e.time,a=l/1e3,r=0,i=0,c="";return a>=60*60?(i=Math.floor(a/3600),r=Math.floor((a-i*3600)/60),a=a-i*3600-r*60):a>=60&&(r=Math.floor(a/60),a=a-r*60),i>0?r===0?c=`${i} jam lagi`:c=`${i} jam ${r} menit lagi`:r>0?a===0?c=`${r} menit lagi`:c=`${r} menit ${a} detik lagi`:c=`${a} detik lagi`,`${h(t.name)} ${c}`}function g(t){switch(t){case"fajr":return"Subuh";case"sunrise":return"Syuruq";case"zuhr":return"Zuhur";case"asr":return"Ashar";case"maghrib":return"Maghrib";case"isha":return"Isha"}}function h(t){let l="";return t.endsWith("Iqama")&&(l="Iqamah ",t=t.replace(/Iqama$/,"")),l+g(t)}function w(){let t=I(e.time.getDay()),l=T(e.time,!0),a=y(e.time).replace(/\//g,"-"),r=q(e.time).replace(/\//g,"-"),i=e.images[e.activeImage],c={},d=[];i!=null&&(d=[m("img#main-image",{src:i.url,loading:"lazy"})],c={style:{"--main-color":i.mainColor,"--header-main":i.headerMain,"--header-accent":i.headerAccent,"--header-color":i.headerFont,"--footer-main":i.footerMain,"--footer-accent":i.footerAccent,"--footer-color":i.footerFont}});let f=e.events.map((p,$)=>{let S=$===e.nextEvent?"event--target":null,x=[m("p.event__name",g(p.name)),m("p.event__time",T(p.time))];return v(p.iqama)&&x.push(m("p.event__iqama",T(p.iqama))),m(".event",{class:S},x)});return d.push(m("#header",m("p#clock",l),m("p#date",`${t}, ${a} M / ${r} H`),m("p#countdown",o())),m("#footer",m(".footer__space"),...f,m(".footer__space"))),m("#app",c,d)}function b(){u(),s(),n()}return{view:w,oninit:b}}function j(){m.mount(document.body,E)}j();})();
